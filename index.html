<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Porori Mental HUD</title>

<!-- ë°°ë‹¬ì˜ë¯¼ì¡± ê¸€ê¼´ -->
<link href="https://cdn.jsdelivr.net/gh/webfontworld/baemin/BMDOHYEON.css" rel="stylesheet">

<style>
body {
  margin: 0;
  background: transparent;
  font-family: 'BMDOHYEON', sans-serif;
}

/* ===== HUD ===== */
#hud {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 420px;
}

/* ===== ë„¤ë¹„ ===== */
#nav-box {
  position: absolute;
  bottom: 20px;
  left: 20px;
  width: 300px;
}

/* ë„¤ì˜¨ ë°•ìŠ¤ */
.neon-box {
  border: 2px solid #ffff00;
  box-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00;
  padding: 8px;
  margin-bottom: 10px;
}

/* ì´ë¦„ */
#name {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 32px;
  color: #ffff00;
  text-shadow: 0 0 5px #ffff00, 0 0 10px #ffff00;
}

#logo {
  width: 40px;
}

/* ë©˜íƒˆë°” */
#mental-container {
  width: 400px;
  height: 30px;
  border: 2px solid #ffff00;
  box-shadow: 0 0 10px #ffff00;
  background: #111;
  margin-bottom: 5px;
}

#mental-bar {
  height: 100%;
  width: 100%;
  background: #00ff00;
  transition: width 0.1s linear, background 0.3s;
}

#mental-text {
  color: #ffff00;
  font-size: 26px;
  text-shadow: 0 0 5px #ffff00;
  margin-bottom: 8px;
}

/* ì§€ë„ */
#map {
  width: 100%;
  height: 250px;
}

/* ê¹œë¹¡ì„ */
@keyframes blinkSlow {
  0% { opacity: 1; }
  50% { opacity: 0.2; }
  100% { opacity: 1; }
}
.blink-slow { animation: blinkSlow 2s infinite; }

@keyframes blinkFast {
  0% { opacity: 1; }
  50% { opacity: 0.2; }
  100% { opacity: 1; }
}
.blink-fast { animation: blinkFast 1s infinite; }

</style>
</head>

<body>

<!-- HUD -->
<div id="hud">

  <div class="neon-box">
    <div id="name">
      <img src="porori.png" id="logo">
      í¬ë¡œë¦¬ì™“ì°
    </div>
  </div>

  <div id="mental-container">
    <div id="mental-bar"></div>
  </div>

  <div id="mental-text">100.0%</div>

</div>

<!-- ë„¤ë¹„ -->
<div id="nav-box">
  <div class="neon-box">
    <div id="map"></div>
  </div>
</div>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===================
   ë©˜íƒˆ ì‹œìŠ¤í…œ
=================== */
let mental = 100;
const decreasePerMinute = 0.5;
const decreasePerSecond = decreasePerMinute / 60;
const decreasePerTick = decreasePerSecond / 10;

const mentalBar = document.getElementById("mental-bar");
const mentalText = document.getElementById("mental-text");

function updateMental() {
  mental -= decreasePerTick;
  if (mental < 0) mental = 0;
  updateUI();
}

function updateUI() {
  mentalBar.style.width = mental + "%";
  mentalText.innerText = mental.toFixed(1) + "%";

  mentalBar.classList.remove("blink-slow", "blink-fast");

  if (mental > 80) mentalBar.style.background = "#00ff00";
  else if (mental > 60) mentalBar.style.background = "#66ff00";
  else if (mental > 40) mentalBar.style.background = "#ffff00";
  else if (mental > 20) {
    mentalBar.style.background = "#ff9900";
    mentalBar.classList.add("blink-slow");
  }
  else {
    mentalBar.style.background = "#ff0000";
    mentalBar.classList.add("blink-fast");
  }
}

setInterval(updateMental, 100);

/* ===================
   íšŒì „ ë„¤ë¹„
=================== */

const map = L.map('map', {
  zoomControl: false,
  attributionControl: false
}).setView([37.5665, 126.9780], 17);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

let marker;

if (navigator.geolocation) {
  navigator.geolocation.watchPosition(position => {

    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const heading = position.coords.heading;

    map.setView([lat, lon]);

    if (!marker) {
      marker = L.circleMarker([lat, lon], {
        radius: 8,
        color: "#ffff00",
        fillColor: "#ffff00",
        fillOpacity: 1
      }).addTo(map);
    } else {
      marker.setLatLng([lat, lon]);
    }

    // ğŸ”¥ ì§€ë„ íšŒì „
    if (heading !== null) {
      document.getElementById("map").style.transform =
        "rotate(" + (-heading) + "deg)";
    }

  }, null, {
    enableHighAccuracy: true
  });
}
</script>

</body>
</html>
