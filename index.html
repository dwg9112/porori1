<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OW Widget</title>
  <style>
    html, body { margin: 0; padding: 0; background: transparent; overflow: hidden; }

    #widget{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: 600px;
      pointer-events: none;
    }

    /* ===== ì™¼ìª½ THIS ì˜ì—­ (2ë°°) ===== */
    #leftWrap{
      position: absolute;
      left: 16px;
      bottom: 16px;

      transform-origin: left bottom;
      transform: scale(2);

      z-index: 10;
      pointer-events: none;
    }

    #leftImg{
      height: 110px;
      width: auto;
      display: block;
    }

    /* ===== ì¤‘ì•™ OW ê¶ ê²Œì´ì§€ (75% = 2.25ë°°) ===== */
    #center{
      position: absolute;
      left: 50%;
      bottom: 16px;

      height: 110px;
      width: auto;

      transform-origin: center bottom;
      transform: translateX(-50%) scale(2.25);

      z-index: 5;
      pointer-events: none;
    }

    /* ===== MENTAL ê²Œì´ì§€ ===== */
    #mentalWrap{
      position: absolute;
      left: 120px;
      bottom: 62px;
      z-index: 999;
      pointer-events: none;
    }

    #mentalLabel{
      font-family: Arial, sans-serif;
      font-weight: 900;
      font-size: 14px;
      letter-spacing: 1px;
      color: #ffffff;
      text-shadow: 0 2px 6px rgba(0,0,0,.65);
      margin: 0 0 4px 0;
      user-select: none;
      line-height: 1;
    }

    /* ë°” í¬ê¸°/ìœ„ì¹˜ ì¡°ì • */
    #mentalBar{
      display:flex;
      gap: 3px;
      padding: 5px 7px;
      border-radius: 10px;
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(2px);
      box-shadow: 0 6px 18px rgba(0,0,0,.25);

      transform-origin: left top;
      transform: translate(-26px, 6px) scaleX(0.625);
    }

    .mentalSeg{
      width: 10px;
      height: 14px;
      border-radius: 4px;
      background: #20d070;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
    }

    .mentalSeg.off{
      background: #f2f2f2;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.15);
    }

    /* =========================================
       ğŸ”¥ ìš°ì¸¡í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë¯¸ë‹ˆë§µ (150% í™•ëŒ€)
       ========================================= */
    #navWrap{
      position: absolute;
      right: 18px;
      bottom: 18px;

      width: 220px;
      height: 220px;

      transform-origin: right bottom;
      transform: scale(1.5); /* âœ… 150% */

      border-radius: 26px;
      background: rgba(8, 10, 14, 0.50);
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
      backdrop-filter: blur(3px);

      z-index: 30;
      pointer-events: none;
      overflow: hidden;
    }

    #navWrap::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: 26px;
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.16),
        inset 0 0 0 7px rgba(0,0,0,.18);
      pointer-events:none;
    }

    /* ì§€ë„ ì˜ì—­ */
    #navMap{
      position:absolute;
      inset: 14px;
      border-radius: 18px;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,.06) 0px,
          rgba(255,255,255,.06) 2px,
          transparent 2px,
          transparent 28px
        );
      overflow:hidden;
    }

    /* ê¸¸(íë¥´ëŠ” ëŠë‚Œ) */
    #road{
      position:absolute;
      left:50%;
      top:-200%;
      width: 44px;
      height: 400%;
      transform: translateX(-50%);
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,.25) 0%,
        rgba(255,255,255,.12) 40%,
        rgba(255,255,255,.25) 100%
      );
      border-radius: 24px;
      opacity: .9;
    }

    /* ë‚´ ìœ„ì¹˜ ì‚¼ê°í˜• */
    #navPlayer{
      position:absolute;
      left:50%;
      bottom: 26px;
      width:0;
      height:0;
      transform: translateX(-50%);
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 18px solid rgba(255,255,255,.95);
      filter: drop-shadow(0 3px 6px rgba(0,0,0,.55));
      z-index: 3;
    }

    /* ë‹¤ìŒ ë°©í–¥ í™”ì‚´í‘œ */
    #nextTurn{
      position:absolute;
      right: 14px;
      top: 10px;
      font-family: Arial, sans-serif;
      font-weight: 900;
      font-size: 14px;
      color: #7CFFB2;
      text-shadow: 0 2px 6px rgba(0,0,0,.7);
      letter-spacing: .5px;
    }

    #nextDist{
      position:absolute;
      right: 14px;
      top: 28px;
      font-family: Arial, sans-serif;
      font-weight: 800;
      font-size: 12px;
      color: rgba(255,255,255,.85);
      text-shadow: 0 2px 6px rgba(0,0,0,.7);
    }
  </style>
</head>

<body>
  <div id="widget">
    <!-- ì™¼ìª½ THIS -->
    <div id="leftWrap">
      <img id="leftImg" src="./THIS.png" alt="THIS" />

      <div id="mentalWrap">
        <div id="mentalLabel">MENTAL</div>
        <div id="mentalBar"></div>
      </div>
    </div>

    <!-- ì¤‘ì•™ ê¶ ê²Œì´ì§€ -->
    <img id="center" src="./ow_thick_000.png" alt="Gauge" />

    <!-- ğŸ”¥ ë„¤ë¹„ê²Œì´ì…˜ ë¯¸ë‹ˆë§µ -->
    <div id="navWrap">
      <div id="navMap">
        <div id="road"></div>
        <div id="navPlayer"></div>
      </div>
      <div id="nextTurn">TURN â†’</div>
      <div id="nextDist">120 m</div>
    </div>
  </div>

  <script>
    /* ===============================
       OW ê¶ ê²Œì´ì§€
       =============================== */
    const OW_INTERVAL_MS = 30000;
    const OW_MAX = 100;
    let owIdx = 0;

    const centerImg = document.getElementById("center");
    const pad3 = n => String(n).padStart(3,"0");

    function updateOW(){
      centerImg.src = `./ow_thick_${pad3(owIdx)}.png?v=${Date.now()}`;
      owIdx = (owIdx >= OW_MAX) ? 0 : owIdx + 1;
    }
    updateOW();
    setInterval(updateOW, OW_INTERVAL_MS);

    /* ===============================
       MENTAL ê²Œì´ì§€
       =============================== */
    const MENTAL_TOTAL = 20;
    const MENTAL_INTERVAL_MS = 10 * 60 * 1000;
    let mentalOn = MENTAL_TOTAL;

    const mentalBar = document.getElementById("mentalBar");
    const mentalSegs = [];

    for (let i=0;i<MENTAL_TOTAL;i++){
      const seg = document.createElement("div");
      seg.className = "mentalSeg";
      mentalBar.appendChild(seg);
      mentalSegs.push(seg);
    }

    function getMentalColor(n){
      if (n >= 16) return "#20d070";
      if (n >= 12) return "#9BEA4A";
      if (n >= 8) return "#D9B400";
      if (n >= 4) return "#FF8A1E";
      return "#FF3B30";
    }

    function renderMental(){
      const color = getMentalColor(mentalOn);
      for (let i=0;i<MENTAL_TOTAL;i++){
        const on = i < mentalOn;
        mentalSegs[i].classList.toggle("off", !on);
        mentalSegs[i].style.backgroundColor = on ? color : "";
      }
    }

    function tickMental(){
      if (mentalOn > 0) mentalOn--;
      else mentalOn = MENTAL_TOTAL;
      renderMental();
    }

    renderMental();
    setInterval(tickMental, MENTAL_INTERVAL_MS);

    /* ===============================
       ğŸ”¥ ë„¤ë¹„ ë„ë¡œ íë¦„ ì• ë‹ˆë©”ì´ì…˜
       =============================== */
    const road = document.getElementById("road");
    let roadPos = 0;

    function animateRoad(){
      roadPos += 0.6;
      road.style.transform = `translate(-50%, ${roadPos}px)`;
      requestAnimationFrame(animateRoad);
    }
    animateRoad();
  </script>
</body>
</html>
