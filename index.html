<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Porori Mental HUD</title>

<link href="https://cdn.jsdelivr.net/gh/webfontworld/baemin/BMDOHYEON.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
  margin: 0;
  background: transparent;
  font-family: 'BMDOHYEON', sans-serif;
  overflow: hidden;
}

/* ===== 네온 박스 ===== */
.neon-box {
  border: 2px solid #00ff00;
  box-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
  padding: 12px;
  color: #00ff00;
  transition: 0.3s;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(6px);
}

/* HUD 위치 */
#hud {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 420px;
}

#nav-box {
  position: absolute;
  bottom: 20px;
  left: 20px;
  width: 300px;
}

#name {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 26px;
  margin-bottom: 12px;
}

#logo {
  width: 36px;
}

/* ===== 멘탈 바 ===== */
#mental-container {
  width: 100%;
  height: 24px;
  background: #111;
  margin-bottom: 6px;
  cursor: pointer;
}

#mental-bar {
  height: 100%;
  width: 100%;
  background: #00ff00;
  transition: width 0.1s linear, background 0.3s;
}

#mental-text {
  font-size: 20px;
}

/* ===== 지도 ===== */
#map {
  width: 100%;
  height: 240px;
  background: transparent;
  filter: grayscale(100%) contrast(300%) brightness(150%);
  mix-blend-mode: screen;
}

/* 깜빡임 */
@keyframes blinkSlow {
  0%,100% { opacity: 1; }
  50% { opacity: 0.2; }
}
.blink-slow { animation: blinkSlow 2s infinite; }

@keyframes blinkFast {
  0%,100% { opacity: 1; }
  50% { opacity: 0.2; }
}
.blink-fast { animation: blinkFast 1s infinite; }

/* 화살표 */
.arrow {
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 22px solid #00ff00;
  transform-origin: center;
}
</style>
</head>

<body>

<div id="hud">
  <div class="neon-box" id="hud-box">
    <div id="name">
      <img src="porori.png" id="logo">
      포로리왓썰의 MENTAL
    </div>

    <div id="mental-container">
      <div id="mental-bar"></div>
    </div>

    <div id="mental-text">100.0%</div>
  </div>
</div>

<div id="nav-box">
  <div class="neon-box" id="nav-neon">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let mental = 100;
let currentColor = "#00ff00";
let arrowIcon;
let marker;

/* ===== 감소 설정 ===== */
const decreasePerMinute = 0.5;
const decreasePerTick = (decreasePerMinute / 60) / 10;

const mentalBar = document.getElementById("mental-bar");
const mentalText = document.getElementById("mental-text");
const hudBox = document.getElementById("hud-box");
const navBox = document.getElementById("nav-neon");
const mentalContainer = document.getElementById("mental-container");

/* ===== 색상 연동 ===== */
function setUIColor(color) {
  currentColor = color;

  mentalBar.style.background = color;
  mentalText.style.color = color;

  hudBox.style.borderColor = color;
  navBox.style.borderColor = color;

  hudBox.style.color = color;
  navBox.style.color = color;

  hudBox.style.boxShadow = `0 0 10px ${color},0 0 20px ${color}`;
  navBox.style.boxShadow = `0 0 10px ${color},0 0 20px ${color}`;

  if (arrowIcon) arrowIcon.style.borderBottomColor = color;
}

/* ===== UI 업데이트 ===== */
function updateUI() {
  mentalBar.style.width = mental + "%";
  mentalText.innerText = mental.toFixed(1) + "%";
  mentalBar.classList.remove("blink-slow","blink-fast");

  if (mental > 80) setUIColor("#00ff00");
  else if (mental > 60) setUIColor("#66ff00");
  else if (mental > 40) setUIColor("#ffff00");
  else if (mental > 20) {
    setUIColor("#ff9900");
    mentalBar.classList.add("blink-slow");
  } else {
    setUIColor("#ff0000");
    mentalBar.classList.add("blink-fast");
  }
}

/* ===== 자동 감소 ===== */
function updateMental() {
  mental -= decreasePerTick;
  if (mental < 0) mental = 0;
  updateUI();
}
setInterval(updateMental, 100);

/* ===== 1초 내 더블터치 +10% ===== */
let tapCount = 0;
let lastTapTime = 0;

mentalContainer.addEventListener("click", function() {
  const now = Date.now();

  if (now - lastTapTime < 1000) tapCount++;
  else tapCount = 1;

  lastTapTime = now;

  if (tapCount >= 2) {
    mental += 10;
    if (mental > 100) mental = 100;
    updateUI();
    tapCount = 0;
  }
});

/* ===== 극단적 도로 전용 지도 ===== */
const map = L.map('map', {
  zoomControl: false,
  attributionControl: false
}).setView([37.5665, 126.9780], 17);

L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png',
  {
    subdomains: 'abcd',
    maxZoom: 19
  }
).addTo(map);

/* ===== 내 위치 ===== */
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(pos => {

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const heading = pos.coords.heading;

    map.setView([lat, lon]);

    if (!marker) {
      arrowIcon = document.createElement("div");
      arrowIcon.className = "arrow";

      const icon = L.divIcon({
        html: arrowIcon,
        className: '',
        iconSize: [24,24]
      });

      marker = L.marker([lat, lon], { icon: icon }).addTo(map);
    } else {
      marker.setLatLng([lat, lon]);
    }

    if (heading !== null) {
      arrowIcon.style.transform = `rotate(${heading}deg)`;
    }

  }, null, { enableHighAccuracy: true });
}
</script>

</body>
</html>
