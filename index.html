<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Porori HUD</title>

<style>
html,body{ margin:0; padding:0; background:transparent; overflow:hidden; }
#widget{
  position:fixed; left:0; right:0; bottom:0;
  height:900px;
  pointer-events:none;
}

/* ===== ÏôºÏ™Ω THIS (2Î∞∞) ===== */
#leftWrap{
  position:absolute; left:16px; bottom:16px;
  transform-origin:left bottom;
  transform:scale(2);
  z-index:10;
}
#leftImg{ height:110px; width:auto; display:block; }

/* ===== Ï§ëÏïô OW Í∂Å Í≤åÏù¥ÏßÄ (scale 2.25) ===== */
#center{
  position:absolute; left:50%; bottom:16px;
  height:110px; width:auto;
  transform-origin:center bottom;
  transform:translateX(-50%) scale(2.25);
  z-index:5;
  display:block;
}

/* ===== On.gif (Ï§ëÏïô ÏúÑ) ===== */
#ultOn{
  position:absolute; left:50%; bottom:16px;
  transform:translateX(-50%);
  height:240px; width:auto;
  display:none;
  z-index:50;
  filter: drop-shadow(0 10px 25px rgba(0,0,0,.35));
}

/* ===== MENTAL ===== */
#mentalWrap{ position:absolute; left:120px; bottom:62px; z-index:999; }
#mentalLabel{
  font-family: Arial, sans-serif;
  font-weight: 900;
  font-size: 14px;
  letter-spacing: 1px;
  color: #ffffff;
  text-shadow: 0 2px 6px rgba(0,0,0,.65);
  margin: 0 0 4px 0;
  user-select: none;
  line-height: 1;
}
#mentalBar{
  display:flex; gap:3px;
  padding:5px 7px;
  border-radius:10px;
  background:rgba(0,0,0,.30);
  backdrop-filter: blur(2px);
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
  transform-origin:left top;
  transform: translate(-26px, 6px) scaleX(0.625);
}
.mentalSeg{
  width:10px; height:14px;
  border-radius:4px;
  background:#20d070;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
}
.mentalSeg.off{
  background:#f2f2f2;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.15);
}

/* =========================================================
   üé∞ Î†àÎ≤Ñ Ïò§Î≤ÑÎ†àÏù¥
   - Î†àÎ≤Ñ ÎÇ¥Î†§Í∞ê(ÏûêÎèô) ‚Üí ÎãπÏ≤® ÌëúÏãú
   - Í≤∞Í≥º 30Ï¥à Î≥¥Ïó¨Ï§å
   - ÏÑúÏÑúÌûà ÏÇ¨ÎùºÏßê (fade-out)
========================================================= */
#rouletteOverlay{
  position:absolute;
  inset:0;
  display:none;
  z-index:200;
  pointer-events:none;
  opacity:1;
  transition: opacity 2.0s ease;
}
#rouletteOverlay.bg{
  background: radial-gradient(circle at 50% 40%, rgba(0,0,0,.28), rgba(0,0,0,.12) 55%, rgba(0,0,0,0) 78%);
}

#rouletteWrap{
  position:absolute;
  left:50%;
  top:44%;
  transform:translate(-50%, -50%);
  width:520px;
  height:520px;
}

#rouletteTitle{
  position:absolute;
  left:50%;
  top:-64px;
  transform:translateX(-50%);
  font-family: Arial, sans-serif;
  font-weight: 900;
  font-size: 34px;
  letter-spacing: 1px;
  color: rgba(255,255,255,.95);
  text-shadow: 0 10px 30px rgba(0,0,0,.55), 0 0 18px rgba(255,255,255,.25);
  white-space:nowrap;
}

/* ‚úÖ ÌûåÌä∏/ÏÑ§Î™Ö Î¨∏Íµ¨ Ï†úÍ±∞ */
#rouletteHint{ display:none !important; }

#rouletteGlow{
  position:absolute;
  inset:-34px;
  border-radius: 999px;
  background: radial-gradient(circle, rgba(255,255,255,.10), rgba(0,0,0,0) 70%);
  filter: blur(2px);
  z-index:-1;
}

/* Í≤∞Í≥º Ïπ¥Îìú */
#rouletteResult{
  position:absolute;
  left:50%;
  bottom:-92px;
  transform:translateX(-50%);
  min-width: 380px;
  padding: 14px 18px;
  border-radius: 16px;

  font-family: Arial, sans-serif;
  font-weight: 900;
  font-size: 22px;
  letter-spacing: .5px;
  color: rgba(255,255,255,.95);
  text-align:center;

  background: rgba(0,0,0,.55);
  box-shadow: 0 18px 48px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.18);
  text-shadow: 0 10px 25px rgba(0,0,0,.55);
  display:none;
}

/* =========================
   üé∞ Î†àÎ≤Ñ Î®∏Ïã† (Ïä¨Î°Ø ÎäêÎÇå)
========================= */
#leverMachine{
  width:520px;
  height:520px;
  position:relative;
}

#leverTopText{
  position:absolute;
  left:50%;
  top:18px;
  transform:translateX(-50%);
  font-family: Arial, sans-serif;
  font-weight: 900;
  font-size: 28px;
  letter-spacing: 1px;
  color: rgba(255,255,255,.95);
  text-shadow: 0 10px 30px rgba(0,0,0,.55);
}

#leverBody{
  position:absolute;
  left:50%;
  top:56%;
  transform:translate(-50%,-50%);
  width:520px;
  height:520px;
  display:flex;
  align-items:center;
  justify-content:center;
}

#leverWindow{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:380px;
  height:220px;
  border-radius: 26px;
  background: rgba(0,0,0,.55);
  box-shadow: 0 22px 60px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.18);
  overflow:hidden;
}

#leverShine{
  position:absolute;
  inset:-40px;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.18), rgba(255,255,255,0) 55%);
  transform: rotate(12deg);
}

#leverWinner{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;

  font-family: Arial, sans-serif;
  font-weight: 900;
  font-size: 44px;              /* ÌÅ¨Í≤å */
  letter-spacing: 1px;
  color: rgba(255,255,255,.98);
  text-shadow: 0 12px 30px rgba(0,0,0,.6);
  padding: 0 18px;
  text-align:center;
  white-space:nowrap;
}

#leverRod{
  position:absolute;
  right:18px;
  top:86px;
  width:40px;
  height:340px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  transform-origin: 50% 0%;
  filter: drop-shadow(0 16px 28px rgba(0,0,0,.45));
}

#leverRod::before{
  content:"";
  position:absolute;
  top:32px;
  width:14px;
  height:260px;
  border-radius: 999px;
  background: linear-gradient(to bottom, rgba(255,255,255,.65), rgba(255,255,255,.18));
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.18);
}

#leverKnob{
  position:absolute;
  top:0;
  width:44px;
  height:44px;
  border-radius:999px;
  background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.95), rgba(255,255,255,.15) 35%, rgba(0,0,0,.25) 100%);
  box-shadow: 0 14px 26px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.22);
}

/* Î†àÎ≤Ñ ÎãπÍ∏∞Í∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò */
@keyframes leverPull {
  0%   { transform: translateY(0) rotate(0deg); }
  55%  { transform: translateY(150px) rotate(8deg); }
  72%  { transform: translateY(150px) rotate(8deg); }
  100% { transform: translateY(0) rotate(0deg); }
}
#leverRod.pull{
  animation: leverPull 950ms cubic-bezier(.2,.9,.2,1);
}

@keyframes divaPop {
  0%   { transform:translate(-50%, -50%) scale(1); }
  35%  { transform:translate(-50%, -50%) scale(1.02); }
  70%  { transform:translate(-50%, -50%) scale(0.995); }
  100% { transform:translate(-50%, -50%) scale(1); }
}
#rouletteWrap.pop { animation: divaPop 600ms ease; }
</style>
</head>

<body>
<div id="widget">

  <!-- ÏôºÏ™Ω THIS + MENTAL -->
  <div id="leftWrap">
    <img id="leftImg" src="./THIS.png" alt="THIS"/>
    <div id="mentalWrap">
      <div id="mentalLabel">MENTAL</div>
      <div id="mentalBar"></div>
    </div>
  </div>

  <!-- Ï§ëÏïô OW Í≤åÏù¥ÏßÄ -->
  <img id="center" src="./ow_thick_000.png" alt="Gauge"/>

  <!-- On.gif -->
  <img id="ultOn" src="./On.gif" alt="On"/>

  <!-- üé∞ Î†àÎ≤Ñ Ïò§Î≤ÑÎ†àÏù¥ -->
  <div id="rouletteOverlay" class="bg">
    <div id="rouletteWrap">
      <div id="rouletteGlow"></div>
      <div id="rouletteTitle">Î£∞Î†õ START!</div>

      <!-- Î£∞Î†õ ÎåÄÏã† Î†àÎ≤Ñ Î®∏Ïã† -->
      <div id="leverMachine">
        <div id="leverTopText">PULL!</div>

        <div id="leverBody">
          <div id="leverWindow">
            <div id="leverShine"></div>
            <div id="leverWinner">READY</div>
          </div>

          <div id="leverRod">
            <div id="leverKnob"></div>
          </div>
        </div>

        <div id="rouletteResult"></div>
      </div>
    </div>
  </div>

</div>

<script>
/* =========================================================
   üîä "D.Va ÎäêÎÇå" Ïó¨ÏÑ± TTS
========================================================= */
let divaVoice = null;

function chooseDivaVoice(){
  if (!("speechSynthesis" in window)) return null;
  const voices = window.speechSynthesis.getVoices();

  let v =
    voices.find(x => (x.lang||"").toLowerCase().startsWith("ko") && /(female|woman|girl)/i.test(x.name)) ||
    voices.find(x => (x.lang||"").toLowerCase().startsWith("ko") && /(Ïó¨|Ïó¨ÏÑ±|ÏÜåÎÖÄ|yuna|sora|seo|ji)/i.test(x.name)) ||
    voices.find(x => (x.lang||"").toLowerCase().startsWith("ko")) ||
    voices.find(x => /(female|woman|girl)/i.test(x.name)) ||
    null;

  return v || null;
}

function ensureVoiceReady(){
  try{
    if (!("speechSynthesis" in window)) return;
    const tryPick = () => { divaVoice = chooseDivaVoice(); };
    tryPick();
    if (!divaVoice){
      window.speechSynthesis.onvoiceschanged = () => {
        divaVoice = chooseDivaVoice();
      };
    }
  }catch(e){}
}
ensureVoiceReady();

function speakDiva(text){
  try{
    if (!("speechSynthesis" in window)) return;
    const synth = window.speechSynthesis;
    synth.cancel();

    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ko-KR";
    u.rate = 1.18;
    u.pitch = 1.45;
    u.volume = 1.0;

    if (!divaVoice) divaVoice = chooseDivaVoice();
    if (divaVoice) u.voice = divaVoice;

    synth.speak(u);
  }catch(e){}
}

/* =========================================================
   üéµ Ïä¨Î°Ø Î†àÎ≤Ñ "Îî∏ÍπçÎî∏Íπç" ÏÇ¨Ïö¥Îìú (WebAudio)
   - ÏµúÏ¥à 1Ìöå ÏÇ¨Ïö©Ïûê Ï†úÏä§Ï≤ò ÏóÜÏúºÎ©¥ Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÏÜåÎ¶¨Î•º ÎßâÏùÑ Ïàò ÏûàÏùå
========================================================= */
let audioCtx = null;

function getAudioCtx(){
  if (!audioCtx){
    const AC = window.AudioContext || window.webkitAudioContext;
    if (!AC) return null;
    audioCtx = new AC();
  }
  return audioCtx;
}

function unlockAudio(){
  const ctx = getAudioCtx();
  if (!ctx) return;
  if (ctx.state === "suspended"){
    ctx.resume().catch(()=>{});
  }
}

// ‚ÄúÏµúÏ¥à 1Ìöå‚Äù ÏÇ¨Ïö©Ïûê Ï†úÏä§Ï≤òÎ°ú Ïò§ÎîîÏò§ Ïû†Í∏à Ìï¥Ï†ú ÏãúÎèÑ
window.addEventListener("pointerdown", unlockAudio, { once:true });
window.addEventListener("keydown", unlockAudio, { once:true });

function clickSound({ t=0, pitch=900, dur=0.035, gain=0.22 } = {}){
  const ctx = getAudioCtx();
  if (!ctx) return;
  if (ctx.state === "suspended") return; // Ïû†Í∏à ÏÉÅÌÉúÎ©¥ Ï°∞Ïö©Ìûà Ìå®Ïä§

  const now = ctx.currentTime + t;

  // ÏïÑÏ£º ÏßßÏùÄ ÌÜ°(ÌÅ¥Î¶≠) + ÏÇ¥ÏßùÏùò ÎÖ∏Ïù¥Ï¶àÎ°ú 'Îî∏Íπç' ÎäêÎÇå
  const o = ctx.createOscillator();
  const g = ctx.createGain();

  o.type = "square";
  o.frequency.setValueAtTime(pitch, now);
  o.frequency.exponentialRampToValueAtTime(Math.max(80, pitch*0.65), now + dur);

  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(gain, now + 0.003);
  g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

  o.connect(g).connect(ctx.destination);
  o.start(now);
  o.stop(now + dur);

  // ÎØ∏ÏÑ∏Ìïú 'Îî±' ÎÖ∏Ïù¥Ï¶à
  const bufferSize = Math.floor(ctx.sampleRate * 0.02);
  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i=0;i<bufferSize;i++){
    // Ï¥àÎ∞òÎßå Í∞ïÌïòÍ≥† Í∏âÍ≤©Ìûà Í∞êÏá†
    const decay = Math.exp(-i / (bufferSize * 0.18));
    data[i] = (Math.random()*2 - 1) * 0.22 * decay;
  }
  const noise = ctx.createBufferSource();
  const ng = ctx.createGain();
  noise.buffer = buffer;
  ng.gain.setValueAtTime(0.0001, now);
  ng.gain.exponentialRampToValueAtTime(gain*0.55, now + 0.001);
  ng.gain.exponentialRampToValueAtTime(0.0001, now + 0.02);
  noise.connect(ng).connect(ctx.destination);
  noise.start(now);
}

function leverClickPattern(){
  // ÎãπÍ∏∏ Îïå: Ïó¨Îü¨ Î≤à Îî∏ÍπçÎî∏Íπç
  clickSound({ t: 0.00, pitch: 1050, gain: 0.20, dur: 0.030 });
  clickSound({ t: 0.10, pitch: 980,  gain: 0.18, dur: 0.030 });
  clickSound({ t: 0.22, pitch: 900,  gain: 0.18, dur: 0.032 });
  // ÎÇ¥Î†§Í∞à Îïå ÌÅ∞ Îî∏Íπç
  clickSound({ t: 0.56, pitch: 720,  gain: 0.26, dur: 0.045 });
  // ÎèåÏïÑÏò§Î©∞ ÏûëÏùÄ Îî∏Íπç
  clickSound({ t: 0.86, pitch: 860,  gain: 0.16, dur: 0.028 });
}

/* =========================================================
   ‚úÖ OW Í∂Å Î£®ÌîÑ
   - 0‚Üí100 (50Ï¥à/Ïπ∏)
   - 100% ÎèÑÎã¨ ÌõÑ 30Ï¥à ÎèôÏïà "100% Í≤åÏù¥ÏßÄÎßå" ÌëúÏãú
   - Í∑∏ Ïù¥ÌõÑ On.gif 10Î∂Ñ Ïû¨ÏÉù
   - ÎÅùÎÇòÎ©¥ 0%Î°ú Î¶¨ÏÖã ÌõÑ Î∞òÎ≥µ
   + On.gif ÏãúÏûë ÏàúÍ∞Ñ üé∞ Î†àÎ≤Ñ 1Ìöå
   + ‚úÖ ÏöîÏ≤≠: On.gif ÏãúÏûë ÏßÅÏ†ÑÏóê 100% Í≤åÏù¥ÏßÄ Ïà®ÍπÄ(Í≤πÏπ® Î∞©ÏßÄ)
========================================================= */
const OW_INTERVAL_MS = 50_000;
const HOLD_100_MS    = 30_000;
const ON_DURATION_MS = 10 * 60 * 1000;

const centerImg = document.getElementById("center");
const ultOnImg  = document.getElementById("ultOn");

const pad3  = (n) => String(n).padStart(3,"0");
const owPath = (n) => `./ow_thick_${pad3(n)}.png`;

for (let i=0;i<=100;i++){
  const im = new Image();
  im.src = owPath(i);
}

let owValue = 0;
let chargingTimer = null;
let holdTimer = null;
let onTimer = null;

function setOW(n){
  owValue = Math.max(0, Math.min(100, n));
  centerImg.src = owPath(owValue) + "?v=" + Date.now();
}
function showOn(){
  ultOnImg.style.display = "block";
  ultOnImg.src = "./On.gif?v=" + Date.now();
}
function hideOn(){ ultOnImg.style.display = "none"; }

function clearOWTimers(){
  if (chargingTimer){ clearInterval(chargingTimer); chargingTimer = null; }
  if (holdTimer){ clearTimeout(holdTimer); holdTimer = null; }
  if (onTimer){ clearTimeout(onTimer); onTimer = null; }
}

function startOWLoop(){
  clearOWTimers();
  owValue = 0;
  hideOn();

  // ‚úÖ ÌòπÏãú Ïà®ÍπÄ ÏÉÅÌÉúÎ°ú ÎÇ®Îäî Í≤É Î∞©ÏßÄ
  centerImg.style.visibility = "visible";

  setOW(0);

  chargingTimer = setInterval(() => {
    if (owValue < 100){
      setOW(owValue + 1);
    }

    if (owValue >= 100){
      clearInterval(chargingTimer);
      chargingTimer = null;

      holdTimer = setTimeout(() => {
        // ‚úÖ 100% Í≤åÏù¥ÏßÄÏôÄ On.gif Í≤πÏπ® Î∞©ÏßÄ: On ÏãúÏûë ÏßÅÏ†ÑÏóê Í≤åÏù¥ÏßÄ Ïà®ÍπÄ
        centerImg.style.visibility = "hidden";

        showOn();
        startRouletteSpin(); // Î†àÎ≤Ñ Ïù¥Î≤§Ìä∏

        onTimer = setTimeout(() => {
          hideOn();
          stopRouletteIfRunning();

          // Îã§Ïùå Î£®ÌîÑ Ï†ÑÏóê Îã§Ïãú Î≥¥Ïù¥Í≤å
          centerImg.style.visibility = "visible";
          startOWLoop();
        }, ON_DURATION_MS);

      }, HOLD_100_MS);
    }
  }, OW_INTERVAL_MS);
}
startOWLoop();

/* =========================================================
   MENTAL Í≤åÏù¥ÏßÄ
========================================================= */
const MENTAL_TOTAL = 20;
const MENTAL_INTERVAL_MS = 10 * 60 * 1000;
let mentalOn = MENTAL_TOTAL;

const mentalBar = document.getElementById("mentalBar");
const mentalSegs = [];
for (let i=0;i<MENTAL_TOTAL;i++){
  const seg = document.createElement("div");
  seg.className = "mentalSeg";
  mentalBar.appendChild(seg);
  mentalSegs.push(seg);
}

function getMentalColor(n){
  if (n >= 16) return "#20d070";
  if (n >= 12) return "#9BEA4A";
  if (n >= 8)  return "#D9B400";
  if (n >= 4)  return "#FF8A1E";
  return "#FF3B30";
}
function renderMental(){
  const c = getMentalColor(mentalOn);
  for (let i=0;i<MENTAL_TOTAL;i++){
    const on = i < mentalOn;
    mentalSegs[i].classList.toggle("off", !on);
    mentalSegs[i].style.backgroundColor = on ? c : "";
  }
}
function tickMental(){
  if (mentalOn > 0) mentalOn -= 1;
  else mentalOn = MENTAL_TOTAL;
  renderMental();
}
renderMental();
setInterval(tickMental, MENTAL_INTERVAL_MS);

/* =========================================================
   üé∞ Î†àÎ≤Ñ ÎãπÏ≤® (Î£∞Î†õ ÎåÄÏ≤¥)
   - Î†àÎ≤Ñ ÎÇ¥Î†§Í∞ÄÎ©¥ Í≤∞Í≥º ÌôïÏ†ï
   - Í≤∞Í≥º 30Ï¥à Î≥¥Ïó¨Ï£ºÍ≥† 2Ï¥à ÌéòÏù¥ÎìúÏïÑÏõÉ
   + ‚úÖ Îî∏ÍπçÎî∏Íπç ÏÇ¨Ïö¥Îìú
========================================================= */
const rouletteItems = [
  "Í≥®Î∞òÎåÑÏä§",
  "Ìè¨ÏºìÎ™¨ÎåÑÏä§",
  "ÌÑ∞ÎØ∏ÎÑêÎåÑÏä§",
  "Í¥ÄÏ†úÌÉëÎåÑÏä§",
  "Ïï†Íµê ÌÉÄÏûÑ",
  "ÏÇ¨Ïø†ÎûÄÎ≥¥ÎåÑÏä§",
];

const rouletteOverlay = document.getElementById("rouletteOverlay");
const rouletteWrap = document.getElementById("rouletteWrap");
const rouletteResult = document.getElementById("rouletteResult");

const leverRod = document.getElementById("leverRod");
const leverWinner = document.getElementById("leverWinner");

const ROULETTE_SHOW_MS = 30_000;
const ROULETTE_FADE_MS = 2_000;

let rouletteFadeTimer = null;
let rouletteHideTimer = null;
let leverAnimTimer = null;

function pickWinner(){
  return Math.floor(Math.random() * rouletteItems.length);
}

function startRouletteSpin(){
  stopRouletteIfRunning();

  rouletteOverlay.style.display = "block";
  rouletteOverlay.style.opacity = "1";

  rouletteResult.style.display = "none";
  rouletteResult.textContent = "";

  rouletteWrap.classList.remove("pop");
  void rouletteWrap.offsetWidth;
  rouletteWrap.classList.add("pop");

  // Î†àÎ≤Ñ Ï§ÄÎπÑ
  leverWinner.textContent = "READY";
  leverRod.classList.remove("pull");
  void leverRod.offsetWidth;

  // ‚úÖ ÏûêÎèô Î†àÎ≤Ñ ÎãπÍ∏∞Í∏∞ + ÏÇ¨Ïö¥Îìú
  leverRod.classList.add("pull");
  leverClickPattern();

  const winnerIndex = pickWinner();
  const resultText = rouletteItems[winnerIndex];

  // Î†àÎ≤Ñ ÎÇ¥Î†§Í∞ÄÎäî ÌÉÄÏù¥Î∞çÏóê ÎßûÏ∂∞ Í≤∞Í≥º ÌôïÏ†ï (ÎåÄÎûµ 0.62Ï¥à ÌõÑ)
  leverAnimTimer = setTimeout(() => {
    leverWinner.textContent = resultText;

    rouletteResult.textContent = `ÎãπÏ≤®: ${resultText}`;
    rouletteResult.style.display = "block";

    speakDiva(`Ìè¨Î°úÎ¶¨ Í∂Å Ï§ÄÎπÑ ÏôÑÎ£å!  ${resultText}!  ÏãúÎèô, Í±∞ÎäîÏ§ë!`);

    rouletteFadeTimer = setTimeout(() => {
      rouletteOverlay.style.opacity = "0";
    }, ROULETTE_SHOW_MS);

    rouletteHideTimer = setTimeout(() => {
      rouletteOverlay.style.display = "none";
      rouletteOverlay.style.opacity = "1";
    }, ROULETTE_SHOW_MS + ROULETTE_FADE_MS);
  }, 620);
}

function stopRouletteIfRunning(){
  if (rouletteFadeTimer){ clearTimeout(rouletteFadeTimer); rouletteFadeTimer = null; }
  if (rouletteHideTimer){ clearTimeout(rouletteHideTimer); rouletteHideTimer = null; }
  if (leverAnimTimer){ clearTimeout(leverAnimTimer); leverAnimTimer = null; }

  rouletteOverlay.style.display = "none";
  rouletteOverlay.style.opacity = "1";
  rouletteResult.style.display = "none";

  if (leverRod) leverRod.classList.remove("pull");
  if (leverWinner) leverWinner.textContent = "READY";
}
</script>
</body>
</html>
