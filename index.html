<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Porori HUD</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:transparent;
  overflow:hidden;
}

/* Ï†ÑÏ≤¥ ÏòÅÏó≠ */
#widget{
  position:fixed;
  left:0; right:0; bottom:0;
  height:700px;
  pointer-events:none;
}

/* ===============================
   ÏôºÏ™Ω THIS (2Î∞∞)
================================ */
#leftWrap{
  position:absolute;
  left:16px;
  bottom:16px;
  transform-origin:left bottom;
  transform:scale(2);
  z-index:10;
}
#leftImg{
  height:110px;
  width:auto;
  display:block;
}

/* ===============================
   Ï§ëÏïô Í∂Å Í≤åÏù¥ÏßÄ
================================ */
#center{
  position:absolute;
  left:50%;
  bottom:16px;
  height:110px;
  transform-origin:center bottom;
  transform:translateX(-50%) scale(2.25);
  z-index:5;
}

/* Í∂Å ON GIF */
#ultOn{
  position:absolute;
  left:50%;
  bottom:16px;
  transform:translateX(-50%);
  height:240px;
  display:none;
  z-index:50;
}

/* ===============================
   MENTAL Í≤åÏù¥ÏßÄ
================================ */
#mentalWrap{
  position:absolute;
  left:120px;
  bottom:62px;
  z-index:999;
}

#mentalLabel{
  font-weight:900;
  font-size:14px;
  color:#fff;
  margin-bottom:4px;
}

#mentalBar{
  display:flex;
  gap:3px;
  padding:5px 7px;
  border-radius:10px;
  background:rgba(0,0,0,.3);
  transform-origin:left top;
  transform:translate(-26px,6px) scaleX(0.625);
}

.mentalSeg{
  width:10px;
  height:14px;
  border-radius:4px;
  background:#20d070;
}
.mentalSeg.off{
  background:#f2f2f2;
}
</style>
</head>

<body>
<div id="widget">

  <!-- ÏôºÏ™Ω -->
  <div id="leftWrap">
    <img id="leftImg" src="./THIS.png"/>
    <div id="mentalWrap">
      <div id="mentalLabel">MENTAL</div>
      <div id="mentalBar"></div>
    </div>
  </div>

  <!-- Ï§ëÏïô -->
  <img id="center" src="./ow_thick_000.png"/>
  <img id="ultOn" src="./On.gif"/>

</div>

<script>
/* ===============================
   OW Í∂Å Î£®ÌîÑ
================================ */
const OW_INTERVAL_MS = 30000;
const ON_DELAY_MS = 20000;
const ON_DURATION_MS = 10*60*1000;

const centerImg = document.getElementById("center");
const ultOnImg = document.getElementById("ultOn");

let owValue = 0;
let state = "charging";
let owTimer, onDelayTimer, onDurationTimer;

const pad3 = n => String(n).padStart(3,"0");
const owPath = n => `./ow_thick_${pad3(n)}.png`;

function setOW(n){
  owValue=n;
  centerImg.src = owPath(n)+"?v="+Date.now();
}

function startCharging(){
  state="charging";
  ultOnImg.style.display="none";
  setOW(0);

  clearInterval(owTimer);
  owTimer=setInterval(()=>{
    if(state!=="charging") return;

    if(owValue<100){
      setOW(owValue+1);
    }

    if(owValue>=100){
      state="waitingOn";

      clearTimeout(onDelayTimer);
      onDelayTimer=setTimeout(()=>{
        state="onPlaying";
        ultOnImg.style.display="block";
        ultOnImg.src="./On.gif?v="+Date.now();

        clearTimeout(onDurationTimer);
        onDurationTimer=setTimeout(()=>{
          startCharging(); // üî• Î£®ÌîÑ Î¶¨ÏÖã
        },ON_DURATION_MS);

      },ON_DELAY_MS);
    }

  },OW_INTERVAL_MS);
}

startCharging();

/* ===============================
   MENTAL Í≤åÏù¥ÏßÄ
================================ */
const MENTAL_TOTAL=20;
let mentalOn=MENTAL_TOTAL;

const mentalBar=document.getElementById("mentalBar");
const mentalSegs=[];

for(let i=0;i<MENTAL_TOTAL;i++){
  const seg=document.createElement("div");
  seg.className="mentalSeg";
  mentalBar.appendChild(seg);
  mentalSegs.push(seg);
}

function getColor(v){
  if(v>=16) return "#20d070";
  if(v>=12) return "#9BEA4A";
  if(v>=8) return "#D9B400";
  if(v>=4) return "#FF8A1E";
  return "#FF3B30";
}

function renderMental(){
  const c=getColor(mentalOn);
  mentalSegs.forEach((s,i)=>{
    const on=i<mentalOn;
    s.classList.toggle("off",!on);
    s.style.backgroundColor=on?c:"";
  });
}

function tickMental(){
  if(mentalOn>0) mentalOn--;
  else mentalOn=MENTAL_TOTAL;
  renderMental();
}

renderMental();
setInterval(tickMental,10*60*1000);
</script>
</body>
</html>
